/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(e){var t,n,r,i;typeof window=="undefined"||typeof require=="function"?(n=require("jquery"),t=require("underscore"),r=require("backbone"),i=r,typeof module!="undefined"&&(module.exports=i)):(n=this.$,t=this._,r=this.Backbone,i=this),r.sync=function(e,i,o){var u=t.extend({},o);u.url?u.url=t.result(u,"url"):u.url=t.result(i,"url")||s();var a=u.url.split("/"),l=a[0]!==""?a[0]:a[1];!u.data&&i&&(u.data=u.attrs||i.toJSON(o)||{}),u.patch===!0&&u.data.id==null&&i&&(u.data.id=i.id);var h=i.socket||r.socket||window.socket,p=n.Deferred();h.emit(l+":"+e,u.data,function(e,t){e?(o.error&&o.error(e),p.reject()):(o.success&&o.success(t),p.resolve())});var v=p.promise();return i.trigger("request",i,v,o),v};var s=function(){throw new Error('A "url" property or function must be specified')}})();