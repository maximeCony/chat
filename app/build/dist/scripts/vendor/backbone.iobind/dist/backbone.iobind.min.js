/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(e){var t,n,r,i;typeof window=="undefined"||typeof require=="function"?(n=require("jquery"),t=require("underscore"),r=require("backbone"),i=r,typeof module!="undefined"&&(module.exports=i)):(n=this.$,t=this._,r=this.Backbone,i=this),r.Model.prototype.ioBindVersion="0.4.6",r.Model.prototype.ioBind=function(e,t,n,i){var s=this._ioEvents||(this._ioEvents={}),o=this.url()+":"+e,u=this;"function"==typeof t&&(i=n,n=t,t=this.socket||window.socket||r.socket);var a={name:e,global:o,cbLocal:n,cbGlobal:function(){var t=[e];t.push.apply(t,arguments),u.trigger.apply(u,t)}};return this.bind(a.name,a.cbLocal,i||u),t.on(a.global,a.cbGlobal),s[a.name]?s[a.name].push(a):s[a.name]=[a],this},r.Model.prototype.ioUnbind=function(e,n,i){var s=this._ioEvents||(this._ioEvents={}),o=this.url()+":"+e;"function"==typeof n&&(i=n,n=this.socket||window.socket||r.socket);var u=s[e];if(!t.isEmpty(u)){if(i&&"function"==typeof i){for(var a=0,f=u.length;a<f;a++)i==u[a].cbLocal&&(this.unbind(u[a].name,u[a].cbLocal),n.removeListener(u[a].global,u[a].cbGlobal),u[a]=!1);u=t.compact(u)}else this.unbind(e),n.removeAllListeners(o);u.length===0&&delete s[e]}return this},r.Model.prototype.ioUnbindAll=function(e){var t=this._ioEvents||(this._ioEvents={});e||(e=this.socket||window.socket||r.socket);for(var n in t)this.ioUnbind(n,e);return this},r.Collection.prototype.ioBindVersion="0.4.6",r.Collection.prototype.ioBind=function(e,t,n,i){var s=this._ioEvents||(this._ioEvents={}),o=this.url+":"+e,u=this;"function"==typeof t&&(i=n,n=t,t=this.socket||window.socket||r.socket);var a={name:e,global:o,cbLocal:n,cbGlobal:function(){var t=[e];t.push.apply(t,arguments),u.trigger.apply(u,t)}};return this.bind(a.name,a.cbLocal,i),t.on(a.global,a.cbGlobal),s[a.name]?s[a.name].push(a):s[a.name]=[a],this},r.Collection.prototype.ioUnbind=function(e,n,i){var s=this._ioEvents||(this._ioEvents={}),o=this.url+":"+e;"function"==typeof n&&(i=n,n=this.socket||window.socket||r.socket);var u=s[e];if(!t.isEmpty(u)){if(i&&"function"==typeof i){for(var a=0,f=u.length;a<f;a++)i==u[a].cbLocal&&(this.unbind(u[a].name,u[a].cbLocal),n.removeListener(u[a].global,u[a].cbGlobal),u[a]=!1);u=t.compact(u)}else this.unbind(e),n.removeAllListeners(o);u.length===0&&delete s[e]}return this},r.Collection.prototype.ioUnbindAll=function(e){var t=this._ioEvents||(this._ioEvents={});e||(e=this.socket||window.socket||r.socket);for(var n in t)this.ioUnbind(n,e);return this}})();